<style>
  .stockLevel {
    font-size: 0.625rem;
    font-weight: 700;  
  }

  @media (max-width: 767px) {
    .stockLevelDiv {
      max-width: 50%;
      float: right;
    }

    .SubCategoriesRow .rowMode .product-list .product .shopping .add-note {
      align-items: center !important;
      padding-right: 0;
    }
  }

  @media (max-width: 767.98px) {
    .stockLevelDiv {
      max-width: 50%;
      margin-left: 20px;
    }

    .SubCategoriesRow .rowMode .product-list .product .shopping .add-note {
      align-items: center !important;
      padding-right: 0;
    }
  }

    @media (max-width: 576px) {
    .stockLevelDiv {
      max-width: 100%;
      margin-left: 25px;
    }
  }

</style>
<script>

    const noteIcon = `<i class="fa-solid fa-book fa-xl text-dark"></i>`;

    const listIcon = `<i class="fa-solid fa-heart-circle-check fa-xl text-dark"></i>`;

    function randomStockLevel() {
        let stockLevels = ['IN STOCK', 'LOW STOCK', 'NO STOCK'];
        let stock = stockLevels[Math.floor(Math.random() * stockLevels.length)];
        return stock;
    }

    function stockLevelHtml(level) {
        let bgClass = level == 'IN STOCK' ? 'bg-success' : level == 'LOW STOCK' ? 'bg-warning' : level == 'NO STOCK' ? 'bg-secondary' : false;
        return `<span class="${bgClass} text-center mw-100 d-inline-block text-white pt-1 pb-1 pl-3 pr-3 rounded mt-2 mb-2 stockLevel">${level}</span>`;
    }


    /* grid view */
    let productsGridView = document.querySelectorAll('.product-list.row.colUnGrouped')[0].children;


    [...productsGridView].map((product) => {
        product.setAttribute('data-stocklevel', randomStockLevel());
        let productLevel = product.children[4];
        let showNote = product.children[4].getAttribute('data-show-note');
        productLevel.children[1].children[0].classList.remove('pl-0');
        productLevel.children[1].children[0].classList.remove('col-6');
        productLevel.children[1].children[0].classList.add('col-3', 'mr-2');
        productLevel.children[1].children[0].children[0].children[0].remove();
        productLevel.children[1].children[0].children[0].children[0].innerHTML = listIcon;
      
        if (showNote == 'True') {
          
          productLevel.children[2].children[0].children[0].children[0].remove();
          productLevel.children[2].children[0].children[0].children[0].children[0].innerHTML = noteIcon;
        }

        let addToNoteClone = productLevel.children[2].children[0].children[0].children[0].cloneNode(true);

        productLevel.children[2].children[0].children[0].children[0].remove();

        let newAddToNote = document.createElement('div');
        newAddToNote.classList.add('col-3', 'p-0', 'justify-content-start');
        newAddToNote.innerHTML = addToNoteClone.innerHTML;
        productLevel.children[1].children[0].after(newAddToNote);
        
        let stockLevel = document.createElement('div');
        stockLevel.classList.add('row', 'd-flex', 'justify-content-start', 'ml-2');
        stockLevel.innerHTML = stockLevelHtml(product.getAttribute('data-stocklevel'));
        
        productLevel.children[0].after(stockLevel);

    });


    /* List & mobile views */
    let productsListView = document.querySelectorAll('.product-list.rowUnGrouped')[0].children;
    
    [...productsListView].map((product) => {
    
        product.setAttribute('data-stocklevel', randomStockLevel());
        let desktopProductNode = product.children[1].children[1].children[0];
        let mobileProductNode = product.children[1].children[1].children[1];

        let stockLevel = stockLevelHtml(product.getAttribute('data-stocklevel'));
      
        desktopProductNode.children[1].children[1].children[0].children[0].remove();

        // Add to List - change the "Add to List" text to be the icon
        desktopProductNode.children[1].children[1].children[0].children[0].innerHTML = listIcon;

        // to show or not show the note for each product is determined by this data attribute
        let showNote = desktopProductNode.children[1].getAttribute('data-show-note');

        // remove add note img 
        desktopProductNode.children[1].children[1].children[1].children[0].remove();

        // replace "Add Note" url text with the icon
        desktopProductNode.children[1].children[1].children[1].children[0].innerHTML = noteIcon;

        // remove flex-column class from parent div of the new list and note icons to make them line up better
        desktopProductNode.children[1].children[1].classList.remove('flex-column');
        desktopProductNode.children[1].children[1].classList.add('justify-content-center');

        // lined up the list icon to end or middle depending on whether the note icon shows or not
        if (showNote == 'True') {
          desktopProductNode.children[1].children[1].children[0].classList.add('justify-content-end');
        } else {
          desktopProductNode.children[1].children[1].children[0].classList.add('justify-content-center', 'mr-3');
        }

        let stockLevelDiv = document.createElement('div');
        stockLevelDiv.classList.add('stockLevelDiv', 'mb-2');
        stockLevelDiv.innerHTML = stockLevel;
        desktopProductNode.children[1].children[0].after(stockLevelDiv);


        let addNoteMobile = desktopProductNode.parentNode.children[1].children[0].children[0].children[1].children[0].children[1];

        
        // add stockLevelDiv to the mobile view
        let stockLevelDivMobile = document.createElement('div');
        stockLevelDivMobile.classList.add('stockLevelDiv', 'mt-2', 'mb-2', 'text-right');
        stockLevelDivMobile.innerHTML = stockLevel;

        if (showNote == 'True') {
          desktopProductNode.parentNode.children[1].children[0].children[0].children[1].children[0].children[1].children[1].after(stockLevelDivMobile);
          desktopProductNode.parentNode.children[1].children[0].children[0].children[1].children[0].children[1].children[1].innerHTML = noteIcon;
        } else {
          desktopProductNode.parentNode.children[1].children[0].children[0].children[1].children[0].children[1].after(stockLevelDivMobile);
        }
             
        //remove old add note icon
        desktopProductNode.parentNode.children[1].children[0].children[0].children[1].children[0].children[1].children[0].remove();
        
    });


</script>

